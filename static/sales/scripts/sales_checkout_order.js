(function(){var e,t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};e=jQuery,e.fn.validateCreditCard=function(n,a){var r,i,l,c,o,u,s,h,f,d,p,m;for(l=[{name:"amex",pattern:/^3[47]/,valid_length:[15]},{name:"diners_club_carte_blanche",pattern:/^30[0-5]/,valid_length:[14]},{name:"diners_club_international",pattern:/^36/,valid_length:[14]},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/,valid_length:[16]},{name:"laser",pattern:/^(6304|670[69]|6771)/,valid_length:[16,17,18,19]},{name:"visa_electron",pattern:/^(4026|417500|4508|4844|491(3|7))/,valid_length:[16]},{name:"visa",pattern:/^4/,valid_length:[16]},{name:"mastercard",pattern:/^5[1-5]/,valid_length:[16]},{name:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,valid_length:[12,13,14,15,16,17,18,19]},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,valid_length:[16]}],null==a&&(a={}),null==a.accept&&(a.accept=function(){var e,t,n;for(n=[],e=0,t=l.length;e<t;e++)r=l[e],n.push(r.name);return n}()),m=a.accept,d=0,p=m.length;d<p;d++)if(i=m[d],t.call(function(){var e,t,n;for(n=[],e=0,t=l.length;e<t;e++)r=l[e],n.push(r.name);return n}(),i)<0)throw"Credit card type '"+i+"' is not supported";return c=function(e){var n,c,o;for(o=function(){var e,n,i,c;for(c=[],e=0,n=l.length;e<n;e++)r=l[e],i=r.name,t.call(a.accept,i)>=0&&c.push(r);return c}(),n=0,c=o.length;n<c;n++)if(i=o[n],e.match(i.pattern))return i;return null},u=function(e){var t,n,a,r,i,l;for(a=0,l=e.split("").reverse(),n=r=0,i=l.length;r<i;n=++r)t=l[n],t=+t,n%2?(t*=2,a+=t<10?t:t-9):a+=t;return a%10==0},o=function(e,n){var a;return a=e.length,t.call(n.valid_length,a)>=0},f=function(e){var t,a;return i=c(e),a=!1,t=!1,null!=i&&(a=u(e),t=o(e,i)),n({card_type:i,luhn_valid:a,length_valid:t})},h=function(){var t;return t=s(e(this).val()),f(t)},s=function(e){return e.replace(/[ -]/g,"")},this.bind("input",function(){return e(this).unbind("keyup"),h.call(this)}),this.bind("keyup",function(){return h.call(this)}),0!==this.length&&h.call(this),this}}).call(this),function(e){var t,n=function(){var e=document.createElement("input");return e.setAttribute("onpaste",""),"function"==typeof e.onpaste?"paste":"input"}()+".mask",a=navigator.userAgent,r=/iphone/i.test(a),i=/android/i.test(a);e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(a,l){var c,o,u,s,h,f;return!a&&this.length>0?(c=e(this[0]),c.data(e.mask.dataName)()):(l=e.extend({placeholder:e.mask.placeholder,completed:null},l),o=e.mask.definitions,u=[],s=f=a.length,h=null,e.each(a.split(""),function(e,t){"?"==t?(f--,s=e):o[t]?(u.push(new RegExp(o[t])),null===h&&(h=u.length-1)):u.push(null)}),this.trigger("unmask").each(function(){function c(e){for(;++e<f&&!u[e];);return e}function d(e){for(;--e>=0&&!u[e];);return e}function p(e,t){var n,a;if(!(e<0)){for(n=e,a=c(t);n<f;n++)if(u[n]){if(!(a<f&&u[n].test(x[a])))break;x[n]=x[a],x[a]=l.placeholder,a=c(a)}k(),y.caret(Math.max(h,e))}}function m(e){var t,n,a,r;for(t=e,n=l.placeholder;t<f;t++)if(u[t]){if(a=c(t),r=x[t],x[t]=n,!(a<f&&u[a].test(r)))break;n=r}}function v(e){var t,n,a,i=e.which;8===i||46===i||r&&127===i?(t=y.caret(),n=t.begin,a=t.end,a-n==0&&(n=46!==i?d(n):a=c(n-1),a=46===i?c(a):a),b(n,a),p(n,a-1),e.preventDefault()):27==i&&(y.val(R),y.caret(0,_()),e.preventDefault())}function g(t){var n,a,r,o=t.which,s=y.caret();t.ctrlKey||t.altKey||t.metaKey||o<32||o&&(s.end-s.begin!=0&&(b(s.begin,s.end),p(s.begin,s.end-1)),n=c(s.begin-1),n<f&&(a=String.fromCharCode(o),u[n].test(a)&&(m(n),x[n]=a,k(),r=c(n),i?setTimeout(e.proxy(e.fn.caret,y,r),0):y.caret(r),l.completed&&r>=f&&l.completed.call(y))),t.preventDefault())}function b(e,t){var n;for(n=e;n<t&&n<f;n++)u[n]&&(x[n]=l.placeholder)}function k(){y.val(x.join(""))}function _(e){var t,n,a=y.val(),r=-1;for(t=0,pos=0;t<f;t++)if(u[t]){for(x[t]=l.placeholder;pos++<a.length;)if(n=a.charAt(pos-1),u[t].test(n)){x[t]=n,r=t;break}if(pos>a.length)break}else x[t]===a.charAt(pos)&&t!==s&&(pos++,r=t);return e?k():r+1<s?(y.val(""),b(0,f)):(k(),y.val(y.val().substring(0,r+1))),s?t:h}var y=e(this),x=e.map(a.split(""),function(e,t){if("?"!=e)return o[e]?l.placeholder:e}),R=y.val();y.data(e.mask.dataName,function(){return e.map(x,function(e,t){return u[t]&&e!=l.placeholder?e:null}).join("")}),y.attr("readonly")||y.one("unmask",function(){y.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){clearTimeout(t);var e;R=y.val(),e=_(),t=setTimeout(function(){k(),e==a.length?y.caret(0,e):y.caret(e)},10)}).bind("blur.mask",function(){_(),y.val()!=R&&y.change()}).bind("keydown.mask",v).bind("keypress.mask",g).bind(n,function(){setTimeout(function(){var e=_(!0);y.caret(e),l.completed&&e==y.val().length&&l.completed.call(y)},0)}),_()}))}})}(jQuery);
